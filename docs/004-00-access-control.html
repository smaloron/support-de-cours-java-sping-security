<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-07-02T15:16:03.700381"><title>Module 1 / Chapitre 4 : Autorisation &ndash; Contr&ocirc;le d'Acc&egrave;s | Spring Security</title><script type="application/json" id="virtual-toc-data">[{"id":"l-essentiel","level":0,"title":"L\u0027essentiel","anchor":"#l-essentiel"},{"id":"pour-aller-plus-loin","level":0,"title":"Pour aller plus loin","anchor":"#pour-aller-plus-loin"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Module 1 / Chapitre 4 : Autorisation &ndash; Contr&ocirc;le d'Acc&egrave;s | Spring Security"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Spring Security Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/004-00-access-control.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Module 1 / Chapitre 4 : Autorisation &ndash; Contr&ocirc;le d'Acc&egrave;s | Spring Security"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/004-00-access-control.html#webpage",
    "url": "writerside-documentation/004-00-access-control.html",
    "name": "Module 1 / Chapitre 4 : Autorisation &ndash; Contr&ocirc;le d'Acc&egrave;s | Spring Security",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Spring Security Help"
}</script><!-- End Schema.org --></head><body data-id="004-00-access-control" data-main-title="Module 1 / Chapitre 4 : Autorisation – Contrôle d'Accès" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs=""><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Spring Security  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="004-00-access-control" id="004-00-access-control.md">Module 1 / Chapitre 4 : Autorisation – Contrôle d'Accès</h1><section class="chapter"><h2 id="l-essentiel" data-toc="l-essentiel">L'essentiel</h2><section class="chapter"><h3 id="objectifs-p-dagogiques" data-toc="objectifs-p-dagogiques">Objectifs p&eacute;dagogiques</h3><p id="-rc58wb_11">&Agrave; la fin de cette partie, vous serez capable de :</p><ul class="list _bullet" id="-rc58wb_12"><li class="list__item" id="-rc58wb_13"><p id="-rc58wb_17"><span class="control" id="-rc58wb_18">Expliquer</span> la diff&eacute;rence fondamentale entre un r&ocirc;le et une autorit&eacute;.</p></li><li class="list__item" id="-rc58wb_14"><p id="-rc58wb_19"><span class="control" id="-rc58wb_20">Configurer</span> des r&egrave;gles d'acc&egrave;s bas&eacute;es sur les URL dans votre <code class="code" id="-rc58wb_21">SecurityFilterChain</code>.</p></li><li class="list__item" id="-rc58wb_15"><p id="-rc58wb_22"><span class="control" id="-rc58wb_23">Utiliser</span> les expressions <code class="code" id="-rc58wb_24">hasRole()</code> et <code class="code" id="-rc58wb_25">hasAuthority()</code> pour restreindre l'acc&egrave;s.</p></li><li class="list__item" id="-rc58wb_16"><p id="-rc58wb_26"><span class="control" id="-rc58wb_27">Appliquer</span> ces r&egrave;gles de base au projet TaskMaster.</p></li></ul></section><section class="chapter"><h3 id="introduction-le-pass-vip" data-toc="introduction-le-pass-vip">Introduction : Le Pass VIP</h3><p id="-rc58wb_28">Imaginez que vous arriviez &agrave; l'entr&eacute;e d'un grand &eacute;v&eacute;nement. Le premier agent de s&eacute;curit&eacute; v&eacute;rifie votre billet et votre pi&egrave;ce d'identit&eacute;. Il confirme que vous &ecirc;tes bien la personne que vous pr&eacute;tendez &ecirc;tre et que vous avez le droit d'entrer. C'est l' <span class="control" id="-rc58wb_31">authentification</span>.</p><p id="-rc58wb_29">Maintenant que vous &ecirc;tes &agrave; l'int&eacute;rieur, vous voyez une zone &quot;VIP&quot; et une zone &quot;Acc&egrave;s Backstage&quot;. Vous vous dirigez vers la zone VIP, mais un second agent vous arr&ecirc;te. Il regarde votre bracelet : c'est un bracelet standard, pas un bracelet VIP. Il vous refuse l'acc&egrave;s. C'est l' <span class="control" id="-rc58wb_32">autorisation</span>.</p><p id="-rc58wb_30">L'authentification r&eacute;pond &agrave; &quot;Qui &ecirc;tes-vous ?&quot;. L'autorisation r&eacute;pond &agrave; &quot;Qu'avez-vous le droit de faire ?&quot;. Dans ce chapitre, nous allons donner diff&eacute;rents bracelets (des r&ocirc;les) &agrave; nos utilisateurs et apprendre &agrave; nos &quot;agents de s&eacute;curit&eacute;&quot; (Spring Security) &agrave; v&eacute;rifier ces bracelets avant de donner acc&egrave;s &agrave; certaines zones de notre application.</p></section><section class="chapter"><h3 id="l-autorisation-au-niveau-des-requ-tes-url" data-toc="l-autorisation-au-niveau-des-requ-tes-url">L'autorisation au niveau des requ&ecirc;tes (URL)</h3><p id="-rc58wb_33">La premi&egrave;re ligne de d&eacute;fense de l'autorisation se situe au niveau des URL. C'est la mani&egrave;re la plus globale de s&eacute;curiser votre application. On d&eacute;finit des r&egrave;gles directement dans notre <code class="code" id="-rc58wb_38">SecurityFilterChain</code>.</p><p id="-rc58wb_34">La configuration se fait via la m&eacute;thode <code class="code" id="-rc58wb_39">authorizeHttpRequests()</code>. On y d&eacute;crit, de la r&egrave;gle la plus sp&eacute;cifique &agrave; la plus g&eacute;n&eacute;rale, qui a le droit d'acc&eacute;der &agrave; quoi.</p><p id="-rc58wb_35">Reprenons notre <code class="code" id="-rc58wb_40">SecurityConfig</code> et am&eacute;liorons-la. Imaginons que nous voulons que seuls les admins puissent acc&eacute;der &agrave; une section <code class="code" id="-rc58wb_41">/api/admin/**</code>.</p><div class="code-block" data-lang="java">
// Dans SecurityConfig.java, méthode securityFilterChain

http.authorizeHttpRequests(auth -&gt;auth
        // Règle 1 : Seuls les utilisateurs avec le rôle ADMIN
        // peuvent accéder aux URL commençant par /api/admin
        .requestMatchers(&quot;/api/admin/**&quot;).hasRole(&quot;ADMIN&quot;)

        // Règle 2 : Toute autre requête commençant par /api/**
        // nécessite que l'utilisateur soit authentifié
        .requestMatchers(&quot;/api/**&quot;).authenticated()

        // Règle 3 : Toutes les autres requêtes (ex: page d'accueil, etc.)
        // sont autorisées pour tout le monde
        .anyRequest().permitAll()
)
// ... la suite de la configuration (formLogin, etc.)
</div><aside class="prompt" data-type="tip" data-title="L'ordre est crucial !" id="-rc58wb_37"><p>Les r&egrave;gles sont &eacute;valu&eacute;es dans l'ordre o&ugrave; vous les d&eacute;clarez. Vous devez toujours placer les r&egrave;gles les plus sp&eacute;cifiques (`/api/admin/**`) avant les plus g&eacute;n&eacute;rales (`/api/**`). Si vous inversiez l'ordre, la r&egrave;gle `/api/**` intercepterait toutes les requ&ecirc;tes (y compris `/api/admin/..`) et la r&egrave;gle sp&eacute;cifique pour les admins ne serait jamais atteinte.</p></aside></section><section class="chapter"><h3 id="r-les-vs-autorit-s-permissions" data-toc="r-les-vs-autorit-s-permissions">R&ocirc;les vs. Autorit&eacute;s (Permissions)</h3><p id="-rc58wb_42">Vous avez vu <code class="code" id="-rc58wb_48">hasRole(&quot;ADMIN&quot;)</code>. Spring Security fait une distinction importante :</p><ul class="list _bullet" id="-rc58wb_43"><li class="list__item" id="-rc58wb_49"><p id="-rc58wb_51"><span class="control" id="-rc58wb_52">R&ocirc;le</span>: C'est une repr&eacute;sentation d'un &quot;groupe&quot; ou d'une fonction (ex: <code class="code" id="-rc58wb_53">ADMIN</code>, <code class="code" id="-rc58wb_54">USER</code>, <code class="code" id="-rc58wb_55">MANAGER</code>). Par convention, Spring Security ajoute automatiquement le pr&eacute;fixe <code class="code" id="-rc58wb_56">ROLE_</code> quand vous utilisez <code class="code" id="-rc58wb_57">hasRole()</code>. Donc, <code class="code" id="-rc58wb_58">hasRole(&quot;ADMIN&quot;)</code> v&eacute;rifie en r&eacute;alit&eacute; si l'utilisateur poss&egrave;de l'autorit&eacute; <code class="code" id="-rc58wb_59">ROLE_ADMIN</code>.</p></li><li class="list__item" id="-rc58wb_50"><p id="-rc58wb_60"><span class="control" id="-rc58wb_61">Autorit&eacute; (Authority)</span>: C'est une permission plus fine, une action unitaire (ex: <code class="code" id="-rc58wb_62">project:read</code>, <code class="code" id="-rc58wb_63">task:delete</code>). On la v&eacute;rifie avec <code class="code" id="-rc58wb_64">hasAuthority()</code>. <code class="code" id="-rc58wb_65">hasAuthority(&quot;ROLE_ADMIN&quot;)</code> est strictement &eacute;quivalent &agrave; <code class="code" id="-rc58wb_66">hasRole(&quot;ADMIN&quot;)</code>.</p></li></ul><p id="-rc58wb_44"><span class="control" id="-rc58wb_67">Quand utiliser quoi ?</span></p><ul class="list _bullet" id="-rc58wb_45"><li class="list__item" id="-rc58wb_68"><p id="-rc58wb_70">Utilisez <code class="code" id="-rc58wb_71">hasRole()</code> pour des v&eacute;rifications de haut niveau li&eacute;es &agrave; la fonction de l'utilisateur.</p></li><li class="list__item" id="-rc58wb_69"><p id="-rc58wb_72">Nous verrons dans la partie &quot;Pour aller plus loin&quot; que <code class="code" id="-rc58wb_73">hasAuthority()</code> est beaucoup plus puissant pour une gestion fine des droits.</p></li></ul><p id="-rc58wb_46">Diagramme du processus de d&eacute;cision :</p><style>.theme-dark .plantuml > svg {filter: hue-rotate(180deg) invert(0.9);}div.plantuml {overflow-x: auto;}</style><div class="plantuml"><?xml version="1.0" encoding="us-ascii" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="308px" preserveAspectRatio="none" style="width:1036px;height:308px;background:#FFFFFF;" version="1.1" viewBox="0 0 1036 308" width="1036px" zoomAndPan="magnify"><defs/><g><ellipse cx="488.375" cy="20" fill="#222222" rx="10" ry="10" style="stroke:#222222;stroke-width:1.0;"/><rect fill="#F1F1F1" height="34.1328" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:0.5;" width="141" x="417.875" y="50"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="121" x="427.875" y="71.6016">Requ&#234;te HTTP arrive</text><polygon fill="#F1F1F1" points="396.375,104.1328,580.375,104.1328,592.375,116.1328,580.375,128.1328,396.375,128.1328,384.375,116.1328,396.375,104.1328" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="184" x="396.375" y="120.29">URL correspond &#224; /api/admin/** ?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="17" x="367.375" y="113.8125">oui</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="21" x="592.375" y="113.8125">non</text><polygon fill="#F1F1F1" points="84.5,138.1328,297.5,138.1328,309.5,150.1328,297.5,162.1328,84.5,162.1328,72.5,150.1328,84.5,138.1328" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="213" x="84.5" y="154.29">Utilisateur authentifi&#233; a le r&#244;le 'ADMIN' ?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="17" x="55.5" y="147.8125">oui</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="21" x="309.5" y="147.8125">non</text><rect fill="#F1F1F1" height="34.1328" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:0.5;" width="103" x="11" y="172.1328"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="83" x="21" y="193.7344">Acc&#232;s autoris&#233;</text><ellipse cx="62.5" cy="252.2656" fill="none" rx="11" ry="11" style="stroke:#222222;stroke-width:1.0;"/><ellipse cx="62.5" cy="252.2656" fill="#222222" rx="6" ry="6" style="stroke:#222222;stroke-width:1.0;"/><rect fill="#F1F1F1" height="34.1328" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:0.5;" width="232" x="203.5" y="172.1328"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="212" x="213.5" y="193.7344">Acc&#232;s refus&#233; (Erreur 403 Forbidden)</text><ellipse cx="319.5" cy="252.2656" fill="none" rx="11" ry="11" style="stroke:#222222;stroke-width:1.0;"/><ellipse cx="319.5" cy="252.2656" fill="#222222" rx="6" ry="6" style="stroke:#222222;stroke-width:1.0;"/><polygon fill="#F1F1F1" points="713.25,138.1328,858.25,138.1328,870.25,150.1328,858.25,162.1328,713.25,162.1328,701.25,150.1328,713.25,138.1328" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="145" x="713.25" y="154.29">URL correspond &#224; /api/** ?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="17" x="684.25" y="147.8125">oui</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="21" x="870.25" y="147.8125">non</text><polygon fill="#F1F1F1" points="559,172.1328,701,172.1328,713,184.1328,701,196.1328,559,196.1328,547,184.1328,559,172.1328" style="stroke:#181818;stroke-width:0.5;"/><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="142" x="559" y="188.29">Utilisateur est authentifi&#233; ?</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="17" x="530" y="181.8125">oui</text><text fill="#000000" font-family="sans-serif" font-size="11" lengthAdjust="spacing" textLength="21" x="713" y="181.8125">non</text><rect fill="#F1F1F1" height="34.1328" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:0.5;" width="103" x="485.5" y="206.1328"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="83" x="495.5" y="227.7344">Acc&#232;s autoris&#233;</text><ellipse cx="537" cy="286.2656" fill="none" rx="11" ry="11" style="stroke:#222222;stroke-width:1.0;"/><ellipse cx="537" cy="286.2656" fill="#222222" rx="6" ry="6" style="stroke:#222222;stroke-width:1.0;"/><rect fill="#F1F1F1" height="34.1328" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:0.5;" width="210" x="618" y="206.1328"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="190" x="628" y="227.7344">Redirection vers la page de login</text><ellipse cx="723" cy="286.2656" fill="none" rx="11" ry="11" style="stroke:#222222;stroke-width:1.0;"/><ellipse cx="723" cy="286.2656" fill="#222222" rx="6" ry="6" style="stroke:#222222;stroke-width:1.0;"/><rect fill="#F1F1F1" height="34.1328" rx="3.5" ry="3.5" style="stroke:#181818;stroke-width:0.5;" width="167" x="858" y="172.1328"/><text fill="#000000" font-family="sans-serif" font-size="12" lengthAdjust="spacing" textLength="147" x="868" y="193.7344">Acc&#232;s autoris&#233; (permitAll)</text><ellipse cx="941.5" cy="252.2656" fill="none" rx="11" ry="11" style="stroke:#222222;stroke-width:1.0;"/><ellipse cx="941.5" cy="252.2656" fill="#222222" rx="6" ry="6" style="stroke:#222222;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="488.375" x2="488.375" y1="30" y2="50"/><polygon fill="#454645" points="484.375,40,488.375,50,492.375,40,488.375,44" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="62.5" x2="62.5" y1="206.2656" y2="241.2656"/><polygon fill="#454645" points="58.5,231.2656,62.5,241.2656,66.5,231.2656,62.5,235.2656" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="319.5" x2="319.5" y1="206.2656" y2="241.2656"/><polygon fill="#454645" points="315.5,231.2656,319.5,241.2656,323.5,231.2656,319.5,235.2656" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="72.5" x2="62.5" y1="150.1328" y2="150.1328"/><line style="stroke:#454645;stroke-width:1.0;" x1="62.5" x2="62.5" y1="150.1328" y2="172.1328"/><polygon fill="#454645" points="58.5,162.1328,62.5,172.1328,66.5,162.1328,62.5,166.1328" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="309.5" x2="319.5" y1="150.1328" y2="150.1328"/><line style="stroke:#454645;stroke-width:1.0;" x1="319.5" x2="319.5" y1="150.1328" y2="172.1328"/><polygon fill="#454645" points="315.5,162.1328,319.5,172.1328,323.5,162.1328,319.5,166.1328" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="537" x2="537" y1="240.2656" y2="275.2656"/><polygon fill="#454645" points="533,265.2656,537,275.2656,541,265.2656,537,269.2656" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="723" x2="723" y1="240.2656" y2="275.2656"/><polygon fill="#454645" points="719,265.2656,723,275.2656,727,265.2656,723,269.2656" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="547" x2="537" y1="184.1328" y2="184.1328"/><line style="stroke:#454645;stroke-width:1.0;" x1="537" x2="537" y1="184.1328" y2="206.1328"/><polygon fill="#454645" points="533,196.1328,537,206.1328,541,196.1328,537,200.1328" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="713" x2="723" y1="184.1328" y2="184.1328"/><line style="stroke:#454645;stroke-width:1.0;" x1="723" x2="723" y1="184.1328" y2="206.1328"/><polygon fill="#454645" points="719,196.1328,723,206.1328,727,196.1328,723,200.1328" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="941.5" x2="941.5" y1="206.2656" y2="241.2656"/><polygon fill="#454645" points="937.5,231.2656,941.5,241.2656,945.5,231.2656,941.5,235.2656" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="701.25" x2="630" y1="150.1328" y2="150.1328"/><line style="stroke:#454645;stroke-width:1.0;" x1="630" x2="630" y1="150.1328" y2="172.1328"/><polygon fill="#454645" points="626,162.1328,630,172.1328,634,162.1328,630,166.1328" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="870.25" x2="941.5" y1="150.1328" y2="150.1328"/><line style="stroke:#454645;stroke-width:1.0;" x1="941.5" x2="941.5" y1="150.1328" y2="172.1328"/><polygon fill="#454645" points="937.5,162.1328,941.5,172.1328,945.5,162.1328,941.5,166.1328" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="384.375" x2="191" y1="116.1328" y2="116.1328"/><line style="stroke:#454645;stroke-width:1.0;" x1="191" x2="191" y1="116.1328" y2="138.1328"/><polygon fill="#454645" points="187,128.1328,191,138.1328,195,128.1328,191,132.1328" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="592.375" x2="785.75" y1="116.1328" y2="116.1328"/><line style="stroke:#454645;stroke-width:1.0;" x1="785.75" x2="785.75" y1="116.1328" y2="138.1328"/><polygon fill="#454645" points="781.75,128.1328,785.75,138.1328,789.75,128.1328,785.75,132.1328" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="488.375" x2="488.375" y1="84.1328" y2="104.1328"/><polygon fill="#454645" points="484.375,94.1328,488.375,104.1328,492.375,94.1328,488.375,98.1328" style="stroke:#454645;stroke-width:1.0;"/><!--SRC=[XP11JiCm44NtFiMmQj9Da63LBb2aWa02XA9o03UUb94SEumdEGzBofeRv68uMLGgX7GM8rdZ__J_lv0th14wsh5sebGGpQ9M1Rwt_PSWt6-tBw2PgSErKbH1ybeyGkcPCJJU6UW_8DCDPThKvBBb4cvIY4m7YMyfLH1dL0bP2bgmPT3jy46eelu06Ym2zzznB_BDqyFpOe8mp2elo_up36hF5Fh3-dWAuflnWJOW9CwxlpB6geqYI6wZzMZY-l8AxZplo1XqwHJB6QhKB-9C0PFHf-9ZaDCAfcLdCfzu_IVxY2ZG46Cfv1rqo06iXaRl4Go2zNjoSyonWpFD7ir1qY3N9BcrCuKE-mS0]--></g></svg></div></section><section class="chapter"><h3 id="exercice-4-s-curisation-des-endpoints-de-taskmaster" data-toc="exercice-4-s-curisation-des-endpoints-de-taskmaster">Exercice 4 : S&eacute;curisation des Endpoints de TaskMaster</h3><section class="procedure-steps"><h3 id="exercice-1-4" data-toc="exercice-1-4">Mise en place des règles d'accès pour TaskMaster</h3><p id="-rc58wb_75">Pour notre projet <b id="-rc58wb_83">TaskMaster</b>, nous allons impl&eacute;menter des r&egrave;gles d'acc&egrave;s bas&eacute;es sur les r&ocirc;les que nous avons d&eacute;finis au chapitre pr&eacute;c&eacute;dent (<code class="code" id="-rc58wb_84">USER</code> et <code class="code" id="-rc58wb_85">ADMIN</code> pour les utilisateurs <code class="code" id="-rc58wb_86">john.doe</code> et <code class="code" id="-rc58wb_87">jane.smith</code>).</p><p id="-rc58wb_76">Ajoutez d'abord un nouveau contr&ocirc;leur pour simuler une zone d'administration.</p><p id="-rc58wb_77"><b id="-rc58wb_88">`fr/formation/spring/taskmaster/controller/AdminController.java`</b></p><div class="code-block" data-lang="java">
    package fr.formation.spring.taskmaster.controller;

    import org.springframework.web.bind.annotation.GetMapping;
    import org.springframework.web.bind.annotation.RequestMapping;
    import org.springframework.web.bind.annotation.RestController;

    @RestController
    @RequestMapping(&quot;/api/admin&quot;)
    public class AdminController {

        @GetMapping(&quot;/dashboard&quot;)
        public String getAdminDashboard() {
            return &quot;Bienvenue sur le tableau de bord Administrateur !&quot;;
        }
    }
</div><p id="-rc58wb_79">Modifiez ensuite le bean <code class="code" id="-rc58wb_89">securityFilterChain</code> dans votre classe <code class="code" id="-rc58wb_90">SecurityConfig</code> pour appliquer les r&egrave;gles suivantes :</p><ol class="list _decimal" id="-rc58wb_80" type="1"><li class="list__item" id="-rc58wb_91"><p>Toutes les requ&ecirc;tes vers <code class="code" id="-rc58wb_95">/api/admin/**</code> ne doivent &ecirc;tre accessibles qu'aux utilisateurs ayant le r&ocirc;le <code class="code" id="-rc58wb_96">ADMIN</code>.</p></li><li class="list__item" id="-rc58wb_92"><p>Toutes les requ&ecirc;tes vers <code class="code" id="-rc58wb_97">/api/projects/**</code> doivent &ecirc;tre accessibles &agrave; n'importe quel utilisateur authentifi&eacute; (<code class="code" id="-rc58wb_98">USER</code> ou <code class="code" id="-rc58wb_99">ADMIN</code>).</p></li><li class="list__item" id="-rc58wb_93"><p>L'acc&egrave;s &agrave; la page de connexion (<code class="code" id="-rc58wb_100">/connexion</code>) et aux ressources statiques (CSS, JS) doit &ecirc;tre autoris&eacute; &agrave; tout le monde. (Astuce : pour les ressources statiques, vous pouvez utiliser <code class="code" id="-rc58wb_101">/css/**</code>, <code class="code" id="-rc58wb_102">/js/**</code>, etc.)</p></li><li class="list__item" id="-rc58wb_94"><p>Toute autre requ&ecirc;te doit &ecirc;tre refus&eacute;e (pour renforcer la s&eacute;curit&eacute;).</p></li></ol><p id="-rc58wb_81">Testez votre configuration :</p><ul class="list _bullet" id="-rc58wb_82"><li class="list__item" id="-rc58wb_103"><p>Connectez-vous en tant que <code class="code" id="-rc58wb_105">john.doe</code> (r&ocirc;le USER) et essayez d'acc&eacute;der &agrave; <code class="code" id="-rc58wb_106">/api/projects</code> (devrait fonctionner) puis &agrave; <code class="code" id="-rc58wb_107">/api/admin/dashboard</code> (devrait &eacute;chouer avec une erreur 403 Forbidden).</p></li><li class="list__item" id="-rc58wb_104"><p>Connectez-vous en tant que <code class="code" id="-rc58wb_108">jane.smith</code> (r&ocirc;le ADMIN) et essayez d'acc&eacute;der aux deux URL (les deux devraient fonctionner).</p></li></ul><ol class="list _decimal"></ol></section></section><section class="chapter"><div class="collapse"><div class="collapse__title"><h3 id="correction-exercice-4" data-toc="correction-exercice-4">Correction exercice 4</h3></div><div class="collapse__content"><p id="-rc58wb_109">Voici la configuration mise &agrave; jour du bean <code class="code" id="-rc58wb_115">SecurityFilterChain</code> qui r&eacute;pond aux exigences de l'exercice.</p><p id="-rc58wb_110"><span class="control" id="-rc58wb_116"><code class="code" id="-rc58wb_117">fr/formation/spring/taskmaster/config/SecurityConfig.java</code></span></p><div class="code-block" data-lang="java">
package fr.formation.spring.taskmaster.config;

// ... imports ...

import org.springframework.security.web.util.matcher.AntPathRequestMatcher;

@Configuration
@EnableWebSecurity
public class SecurityConfig {

    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http)
            throws Exception {
        http
                .authorizeHttpRequests(auth -&gt; auth
                        // Règle pour les ressources statiques (si vous en avez)
                        .requestMatchers(&quot;/css/**&quot;, &quot;/js/**&quot;).permitAll()

                        // Règle spécifique pour l'administration
                        .requestMatchers(&quot;/api/admin/**&quot;).hasRole(&quot;ADMIN&quot;)

                        // Règle pour les projets
                        .requestMatchers(&quot;/api/projects/**&quot;).authenticated()

                        // Règle pour la page de connexion
                        .requestMatchers(&quot;/connexion&quot;).permitAll()

                        // Toutes les autres requêtes sont refusées
                        .anyRequest().denyAll()
                )
                .formLogin(form -&gt; form
                        .loginPage(&quot;/connexion&quot;)
                        .loginProcessingUrl(&quot;/connexion&quot;)
                        .defaultSuccessUrl(&quot;/api/projects&quot;, true)
                        .permitAll()
                );

        return http.build();
    }

    // ... reste de la classe (PasswordEncoder, UserDetailsService) ...
}
</div><p id="-rc58wb_112">En testant, vous devriez constater que <code class="code" id="-rc58wb_118">john.doe</code> (connect&eacute;) re&ccedil;oit bien une page d'erreur 403 (Acc&egrave;s Interdit) lorsqu'il tente d'atteindre <code class="code" id="-rc58wb_119">/api/admin/dashboard</code>. C'est la preuve que votre contr&ocirc;le d'acc&egrave;s par r&ocirc;le fonctionne parfaitement ! <code class="code" id="-rc58wb_120">jane.smith</code>, en revanche, peut acc&eacute;der &agrave; toutes les pages.</p><p id="-rc58wb_113">La r&egrave;gle <code class="code" id="-rc58wb_121">.anyRequest().denyAll()</code> est une excellente pratique de s&eacute;curit&eacute; (principe de &quot;fail-safe&quot;). Elle garantit que si vous ajoutez un nouvel endpoint et oubliez de d&eacute;finir une r&egrave;gle pour lui, il sera inaccessible par d&eacute;faut, plut&ocirc;t que potentiellement expos&eacute;.</p></div></div></section></section><section class="chapter"><h2 id="pour-aller-plus-loin" data-toc="pour-aller-plus-loin">Pour aller plus loin</h2><section class="chapter"><h3 id="l-autorisation-au-niveau-des-m-thodes" data-toc="l-autorisation-au-niveau-des-m-thodes">L'autorisation au niveau des m&eacute;thodes</h3><p id="-rc58wb_129">S&eacute;curiser les URL est une bonne premi&egrave;re &eacute;tape, mais c'est souvent trop grossier. Que se passe-t-il si, dans le m&ecirc;me <code class="code" id="-rc58wb_139">ProjectController</code>, vous avez une m&eacute;thode pour lister les projets (accessible &agrave; tous les utilisateurs) et une autre pour supprimer un projet (accessible uniquement aux admins) ?</p><p id="-rc58wb_130">C'est l&agrave; qu'intervient la <span class="control" id="-rc58wb_140">s&eacute;curit&eacute; au niveau des m&eacute;thodes</span>. Elle vous permet de placer des annotations de s&eacute;curit&eacute; directement sur vos m&eacute;thodes de service ou de contr&ocirc;leur.</p><p id="-rc58wb_131"><span class="control" id="-rc58wb_141">&Eacute;tape 1 : Activer la s&eacute;curit&eacute; des m&eacute;thodes</span></p><p id="-rc58wb_132">Dans votre <code class="code" id="-rc58wb_142">SecurityConfig</code>, ajoutez l'annotation <code class="code" id="-rc58wb_143">@EnableMethodSecurity</code>.</p><div class="code-block" data-lang="java">
// Dans SecurityConfig.java

import org.springframework.security.config.annotation.method.configuration.EnableMethodSecurity;

@Configuration
@EnableWebSecurity
@EnableMethodSecurity // Activation de la sécurité au niveau des méthodes
public class SecurityConfig {
    // ...
}
</div><p id="-rc58wb_134"><span class="control" id="-rc58wb_144">&Eacute;tape 2 : Utiliser les annotations</span></p><p id="-rc58wb_135">Les annotations les plus puissantes sont <code class="code" id="-rc58wb_145">@PreAuthorize</code> et <code class="code" id="-rc58wb_146">@PostAuthorize</code>.</p><ul class="list _bullet" id="-rc58wb_136"><li class="list__item" id="-rc58wb_147"><p id="-rc58wb_149"><code class="code" id="-rc58wb_150">@PreAuthorize(&quot;expression&quot;)</code>: L'expression est &eacute;valu&eacute;e <span class="control" id="-rc58wb_151">avant</span> l'ex&eacute;cution de la m&eacute;thode. Si elle est fausse, la m&eacute;thode n'est m&ecirc;me pas appel&eacute;e et une exception <code class="code" id="-rc58wb_152">AccessDeniedException</code> est lev&eacute;e. C'est l'annotation la plus utilis&eacute;e.</p></li><li class="list__item" id="-rc58wb_148"><p id="-rc58wb_153"><code class="code" id="-rc58wb_154">@PostAuthorize(&quot;expression&quot;)</code>: L'expression est &eacute;valu&eacute;e <span class="control" id="-rc58wb_155">apr&egrave;s</span> l'ex&eacute;cution de la m&eacute;thode. C'est utile si la d&eacute;cision d'autorisation d&eacute;pend du r&eacute;sultat de la m&eacute;thode.</p></li></ul><p id="-rc58wb_137"><span class="control" id="-rc58wb_156">Exemple :</span></p><div class="code-block" data-lang="java">

@RestController
@RequestMapping(&quot;/api/projects&quot;)
public class ProjectController {

    @GetMapping
    public List&lt;Project&gt; findAll() {
        // Pas d'annotation = la règle de l'URL s'applique (authenticated())
        return projectService.findAll();
    }

    @DeleteMapping(&quot;/{id}&quot;)
    @PreAuthorize(&quot;hasRole('ADMIN')&quot;) // Seuls les admins peuvent appeler cette méthode
    public void deleteProject(@PathVariable Long id) {
        projectService.deleteById(id);
    }
}
</div></section><section class="chapter"><h3 id="la-puissance-de-spel-spring-expression-language" data-toc="la-puissance-de-spel-spring-expression-language">La puissance de SpEL (Spring Expression Language)</h3><p id="-rc58wb_157">La v&eacute;ritable magie de <code class="code" id="-rc58wb_163">@PreAuthorize</code> vient de sa capacit&eacute; &agrave; interpr&eacute;ter des expressions SpEL. Cela ouvre la porte &agrave; des r&egrave;gles d'autorisation incroyablement fines.</p><p id="-rc58wb_158">Voici quelques expressions utiles :</p><ul class="list _bullet" id="-rc58wb_159"><li class="list__item" id="-rc58wb_164"><p id="-rc58wb_168"><code class="code" id="-rc58wb_169">hasRole('ROLE')</code>/<code class="code" id="-rc58wb_170">hasAuthority('PERMISSION')</code>: Celles que nous connaissons d&eacute;j&agrave;.</p></li><li class="list__item" id="-rc58wb_165"><p id="-rc58wb_171"><code class="code" id="-rc58wb_172">isAuthenticated()</code>/<code class="code" id="-rc58wb_173">isAnonymous()</code>: V&eacute;rifie si l'utilisateur est connect&eacute; ou non.</p></li><li class="list__item" id="-rc58wb_166"><p id="-rc58wb_174"><code class="code" id="-rc58wb_175">authentication.principal.username</code>: Permet d'acc&eacute;der au nom de l'utilisateur courant.</p></li><li class="list__item" id="-rc58wb_167"><p id="-rc58wb_176">Acc&egrave;s aux param&egrave;tres de la m&eacute;thode par leur nom, pr&eacute;fix&eacute;s par <code class="code" id="-rc58wb_177">#</code>.</p></li></ul><p id="-rc58wb_160"><span class="control" id="-rc58wb_178">Le cas d'usage ultime : l'auto-autorisation</span> Imaginez un utilisateur qui veut modifier son propre profil. Il ne doit pas pouvoir modifier celui des autres, sauf s'il est admin.</p><div class="code-block" data-lang="java">
// Dans un UserService
@PreAuthorize(&quot;#username == authentication.principal.username or hasRole('ADMIN')&quot;)
public void updateUserProfile(
        @PathVariable(&quot;username&quot;) String username,
        ProfileData data
) {
    // Logique de mise à jour...
    // Cette ligne n'est atteinte que si la condition est vraie.
}
</div><p id="-rc58wb_162">Cette seule ligne de code exprime une r&egrave;gle de m&eacute;tier complexe et vitale pour la s&eacute;curit&eacute; : &quot;Tu as le droit de faire cette action si le nom d'utilisateur que tu cibles (<code class="code" id="-rc58wb_179">#username</code>) est le tien (<code class="code" id="-rc58wb_180">authentication.principal.username</code>) OU si tu es un administrateur.&quot;</p></section><section class="chapter"><h3 id="utiliser-des-permissions-fines-hasauthority" data-toc="utiliser-des-permissions-fines-hasauthority">Utiliser des permissions fines (<code class="code" id="-rc58wb_187">hasAuthority</code>)</h3><p id="-rc58wb_182">Au lieu de raisonner en &quot;R&ocirc;les&quot;, les applications complexes raisonnent en &quot;Permissions&quot; (Authorities). Un r&ocirc;le devient alors un simple conteneur de permissions.</p><ul class="list _bullet" id="-rc58wb_183"><li class="list__item" id="-rc58wb_188"><p id="-rc58wb_190"><code class="code" id="-rc58wb_191">ROLE_USER</code> pourrait avoir les permissions <code class="code" id="-rc58wb_192">project:read</code>, <code class="code" id="-rc58wb_193">task:read</code>, <code class="code" id="-rc58wb_194">task:write</code>.</p></li><li class="list__item" id="-rc58wb_189"><p id="-rc58wb_195"><code class="code" id="-rc58wb_196">ROLE_ADMIN</code> pourrait avoir toutes les permissions ci-dessus, plus <code class="code" id="-rc58wb_197">project:create</code>, <code class="code" id="-rc58wb_198">project:delete</code>, <code class="code" id="-rc58wb_199">user:manage</code>.</p></li></ul><p id="-rc58wb_184">Cela rend votre syst&egrave;me beaucoup plus flexible. Si demain un <code class="code" id="-rc58wb_200">USER</code> doit pouvoir cr&eacute;er un projet, vous n'avez pas besoin de lui donner le r&ocirc;le <code class="code" id="-rc58wb_201">ADMIN</code>. Vous lui donnez simplement la permission <code class="code" id="-rc58wb_202">project:create</code>.</p><p id="-rc58wb_185">Votre code devient plus clair et plus d&eacute;coupl&eacute; des titres de postes :</p><div class="code-block" data-lang="java">

@PreAuthorize(&quot;hasAuthority('project:delete')&quot;)
public void deleteProject(@PathVariable Long id) { ...}
</div></section><section class="chapter"><h3 id="exercice-5-autorisation-fine-avec-preauthorize" data-toc="exercice-5-autorisation-fine-avec-preauthorize">Exercice 5 : Autorisation fine avec @PreAuthorize</h3><section class="procedure-steps"><h3 id="exercice-1-5" data-toc="exercice-1-5">Mise en place d'autorisations au niveau méthode</h3><p id="-rc58wb_204">Nous allons affiner les autorisations de <b id="-rc58wb_206">TaskMaster</b> en utilisant la s&eacute;curit&eacute; au niveau des m&eacute;thodes.</p><ol class="list _decimal" id="-rc58wb_205" type="1"><li class="list__item" id="-rc58wb_207"><p>Activez la s&eacute;curit&eacute; des m&eacute;thodes dans votre <code class="code" id="-rc58wb_210">SecurityConfig</code> avec <code class="code" id="-rc58wb_211">@EnableMethodSecurity</code>.</p></li><li class="list__item" id="-rc58wb_208"><p>Dans votre <code class="code" id="-rc58wb_212">ProjectController</code> (ou un <code class="code" id="-rc58wb_213">ProjectService</code> appel&eacute; par le contr&ocirc;leur, ce qui est une meilleure pratique), ajoutez une m&eacute;thode pour supprimer un projet. S&eacute;curisez cette m&eacute;thode avec une annotation pour qu'elle ne soit accessible qu'aux utilisateurs ayant le r&ocirc;le <code class="code" id="-rc58wb_214">ADMIN</code>.</p></li><li class="list__item" id="-rc58wb_209"><p>Maintenant, le d&eacute;fi SpEL. Imaginez que chaque projet a un propri&eacute;taire (notre entit&eacute; <code class="code" id="-rc58wb_215">Project</code> a une relation <code class="code" id="-rc58wb_216">owner</code> vers <code class="code" id="-rc58wb_217">User</code>). </p><p id="-rc58wb_218"><b id="-rc58wb_223">Rappel de l'entit&eacute; `Project` :</b></p><div class="code-block" data-lang="java">
            @Entity
            public class Project {
                // ... id, name ...
                @ManyToOne
                private User owner;
            }
            </div><p id="-rc58wb_220">Cr&eacute;ez une m&eacute;thode pour modifier un projet (par exemple, changer son nom). Cette m&eacute;thode ne doit &ecirc;tre accessible qu'&agrave; l' <b id="-rc58wb_224">administrateur</b> OU au <b id="-rc58wb_225">propri&eacute;taire du projet</b>.</p><p id="-rc58wb_221">Astuce : vous devrez probablement r&eacute;cup&eacute;rer l'objet <code class="code" id="-rc58wb_226">Project</code> depuis la base de donn&eacute;es dans votre m&eacute;thode et utiliser son propri&eacute;taire dans l'expression SpEL : <code class="code" id="-rc58wb_227">@PreAuthorize(&quot;hasRole('ADMIN') or @projectRepository.findById(#id).get().owner.username == authentication.name&quot;)</code>.</p><p id="-rc58wb_222">(Note : Pour que `@projectRepository` fonctionne dans SpEL, votre repository doit &ecirc;tre un bean Spring et vous devez l'appeler par son nom de bean, par d&eacute;faut le nom de la classe avec une minuscule au d&eacute;but).</p></li></ol><ol class="list _decimal"></ol></section></section><section class="chapter"><div class="collapse"><div class="collapse__title"><h3 id="correction-exercice-5" data-toc="correction-exercice-5">Correction exercice 5</h3></div><div class="collapse__content"><p id="-rc58wb_228"><span class="control" id="-rc58wb_235">1. Activer la s&eacute;curit&eacute; des m&eacute;thodes</span></p><p id="-rc58wb_229">Ajoutez <code class="code" id="-rc58wb_236">@EnableMethodSecurity</code> sur votre <code class="code" id="-rc58wb_237">SecurityConfig</code>.</p><div class="code-block" data-lang="java">

@Configuration
@EnableWebSecurity
@EnableMethodSecurity(prePostEnabled = true, jsr250Enabled = true)
public class SecurityConfig { /* ... */
}
</div><p id="-rc58wb_231"><span class="control" id="-rc58wb_238">2. Impl&eacute;mentation dans un <code class="code" id="-rc58wb_239">ProjectService</code> (meilleure pratique)</span></p><div class="code-block" data-lang="java">
package fr.formation.spring.taskmaster.service;

import fr.formation.spring.taskmaster.model.Project;
import fr.formation.spring.taskmaster.repository.ProjectRepository;
import org.springframework.security.access.prepost.PreAuthorize;
import org.springframework.stereotype.Service;

@Service
public class ProjectService {

    private final ProjectRepository projectRepository;

    public ProjectService(ProjectRepository projectRepository) {
        this.projectRepository = projectRepository;
    }

    // Accessible à n'importe quel utilisateur authentifié (défini dans SecurityFilterChain)
    public List&lt;Project&gt; findAllProjects() {
        return projectRepository.findAll();
    }

    // Accessible uniquement aux admins
    @PreAuthorize(&quot;hasRole('ADMIN')&quot;)
    public void deleteProject(Long id) {
        // La logique de suppression
        System.out.println(&quot;Suppression du projet &quot; + id + &quot; (ADMIN SEULEMENT)&quot;);
        projectRepository.deleteById(id);
    }

    // Accessible aux admins OU au propriétaire du projet
    @PreAuthorize(&quot;hasRole('ADMIN') or &quot; +
            &quot;@projectRepository.findById(#project.id).get().owner.username &quot; +
            &quot;== authentication.principal.username&quot;)
    public Project updateProjectName(Project project, String newName) {
        // La vérification PreAuthorize est faite AVANT l'exécution de cette ligne
        project.setName(newName);
        System.out.println(&quot;Mise à jour du projet &quot; + project.getId());
        return projectRepository.save(project);
    }
}
</div><p id="-rc58wb_233">Pour faire fonctionner cet exemple, il faut que votre <code class="code" id="-rc58wb_240">UserDetailsService</code> charge bien un objet <code class="code" id="-rc58wb_241">UserDetails</code> complet, et que votre entit&eacute; <code class="code" id="-rc58wb_242">Project</code> ait bien un lien vers <code class="code" id="-rc58wb_243">User</code> en tant que <code class="code" id="-rc58wb_244">owner</code>. Le <code class="code" id="-rc58wb_245">authentication.principal</code> contiendra l'objet `UserDetails` que vous avez fourni.</p><p id="-rc58wb_234">Cet exemple montre la puissance incroyable de SpEL, vous permettant d'encoder des r&egrave;gles de m&eacute;tier complexes directement au plus pr&egrave;s de la logique concern&eacute;e.</p></div></div></section><section class="chapter"><h3 id="auto-valuation" data-toc="auto-valuation">Auto-&eacute;valuation</h3><ol class="list _decimal" id="-rc58wb_246" type="1"><li class="list__item" id="-rc58wb_247"><p id="-rc58wb_252"><span class="control" id="-rc58wb_253">Question ouverte :</span> Expliquez la diff&eacute;rence d'approche entre la s&eacute;curisation par URL (<code class="code" id="-rc58wb_254">authorizeHttpRequests</code>) et la s&eacute;curisation par m&eacute;thode (<code class="code" id="-rc58wb_255">@PreAuthorize</code>). Quand utiliseriez-vous l'une plut&ocirc;t que l'autre ?</p></li><li class="list__item" id="-rc58wb_248"><p id="-rc58wb_256"><span class="control" id="-rc58wb_258">QCM :</span> Quelle annotation faut-il ajouter &agrave; une classe de configuration pour activer <code class="code" id="-rc58wb_259">@PreAuthorize</code>?</p><ul class="list _bullet" id="-rc58wb_257"><li class="list__item" id="-rc58wb_260"><p id="-rc58wb_264">a) <code class="code" id="-rc58wb_265">@EnableSecurity</code></p></li><li class="list__item" id="-rc58wb_261"><p id="-rc58wb_266">b) <code class="code" id="-rc58wb_267">@EnableWebSecurity</code></p></li><li class="list__item" id="-rc58wb_262"><p id="-rc58wb_268">c) <code class="code" id="-rc58wb_269">@EnableGlobalMethodSecurity</code> (ancienne version) ou <code class="code" id="-rc58wb_270">@EnableMethodSecurity</code> (nouvelle version)</p></li><li class="list__item" id="-rc58wb_263"><p id="-rc58wb_271">d) <code class="code" id="-rc58wb_272">@Secure</code></p></li></ul></li><li class="list__item" id="-rc58wb_249"><p id="-rc58wb_273"><span class="control" id="-rc58wb_275">QCM :</span> L'expression <code class="code" id="-rc58wb_276">hasRole('MANAGER')</code> est &eacute;quivalente &agrave; :</p><ul class="list _bullet" id="-rc58wb_274"><li class="list__item" id="-rc58wb_277"><p id="-rc58wb_281">a) <code class="code" id="-rc58wb_282">hasAuthority('MANAGER')</code></p></li><li class="list__item" id="-rc58wb_278"><p id="-rc58wb_283">b) <code class="code" id="-rc58wb_284">hasAuthority('ROLE_MANAGER')</code></p></li><li class="list__item" id="-rc58wb_279"><p id="-rc58wb_285">c) <code class="code" id="-rc58wb_286">isManager()</code></p></li><li class="list__item" id="-rc58wb_280"><p id="-rc58wb_287">d) Aucune de ces r&eacute;ponses.</p></li></ul></li><li class="list__item" id="-rc58wb_250"><p id="-rc58wb_288"><span class="control" id="-rc58wb_289">Question ouverte :</span> Donnez un exemple de cas d'utilisation o&ugrave; <code class="code" id="-rc58wb_290">@PostAuthorize</code> serait plus pertinent que <code class="code" id="-rc58wb_291">@PreAuthorize</code>.</p></li><li class="list__item" id="-rc58wb_251"><p id="-rc58wb_292"><span class="control" id="-rc58wb_294">QCM :</span> Dans une expression SpEL <code class="code" id="-rc58wb_295">@PreAuthorize</code>, comment acc&egrave;de-t-on au nom de l'utilisateur actuellement connect&eacute; ?</p><ul class="list _bullet" id="-rc58wb_293"><li class="list__item" id="-rc58wb_296"><p id="-rc58wb_300">a) <code class="code" id="-rc58wb_301">user.name</code></p></li><li class="list__item" id="-rc58wb_297"><p id="-rc58wb_302">b) <code class="code" id="-rc58wb_303">security.context.user.name</code></p></li><li class="list__item" id="-rc58wb_298"><p id="-rc58wb_304">c) <code class="code" id="-rc58wb_305">authentication.getPrincipal().getUsername()</code></p></li><li class="list__item" id="-rc58wb_299"><p id="-rc58wb_306">d) <code class="code" id="-rc58wb_307">authentication.principal.username</code> ou <code class="code" id="-rc58wb_308">authentication.name</code></p></li></ul></li></ol></section><section class="chapter"><h3 id="conclusion" data-toc="conclusion">Conclusion</h3><p id="-rc58wb_309">Vous ma&icirc;trisez maintenant les deux niveaux de contr&ocirc;le d'acc&egrave;s de Spring Security ! Vous savez mettre en place une premi&egrave;re barri&egrave;re au niveau des URL, puis affiner drastiquement les permissions au c&oelig;ur m&ecirc;me de votre logique m&eacute;tier gr&acirc;ce aux annotations et &agrave; la puissance de SpEL.</p><p id="-rc58wb_310">Vous comprenez la diff&eacute;rence cruciale entre les r&ocirc;les et les permissions, ce qui vous place sur la voie de la conception de syst&egrave;mes de s&eacute;curit&eacute; &eacute;volutifs et maintenables. Vous avez transform&eacute; votre application d'un lieu &quot;ouvert &agrave; tous&quot; &agrave; une structure organis&eacute;e avec des zones d'acc&egrave;s diff&eacute;renci&eacute;es, comme toute application professionnelle.</p><p id="-rc58wb_311">Dans le prochain chapitre, nous allons nous attaquer &agrave; un ennemi invisible mais redoutable : l'attaque CSRF. Spring Security nous prot&egrave;ge par d&eacute;faut, mais il est essentiel de comprendre comment cette protection fonctionne pour ne pas la d&eacute;sactiver par erreur.</p></section></section><div class="last-modified">15 juin 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="003-00-authentication.html" class="navigation-links__prev">Module 1 / Chapitre 3 : Authentification &ndash; Premiers Pas</a><a href="005-00-csrf.html" class="navigation-links__next">Module 1 / Chapitre 5 : Protection contre les Attaques CSRF</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>