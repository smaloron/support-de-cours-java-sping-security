<!DOCTYPE html SYSTEM "about:legacy-compat">
<html lang="en-US" data-preset="contrast" data-primary-color="#307FFF"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="UTF-8"><meta name="robots" content="noindex"><meta name="built-on" content="2025-06-27T16:32:46.179289"><title>Module 1 / Chapitre 5 : Protection contre les Attaques CSRF | Spring Security</title><script type="application/json" id="virtual-toc-data">[{"id":"l-essentiel","level":0,"title":"L\u0027essentiel","anchor":"#l-essentiel"},{"id":"pour-aller-plus-loin","level":0,"title":"Pour aller plus loin","anchor":"#pour-aller-plus-loin"}]</script><script type="application/json" id="topic-shortcuts"></script><link href="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.css" rel="stylesheet"><meta name="msapplication-TileColor" content="#000000"><link rel="apple-touch-icon" sizes="180x180" href="https://jetbrains.com/apple-touch-icon.png"><link rel="icon" type="image/png" sizes="32x32" href="https://jetbrains.com/favicon-32x32.png"><link rel="icon" type="image/png" sizes="16x16" href="https://jetbrains.com/favicon-16x16.png"><meta name="msapplication-TileImage" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-144x144.png"><meta name="msapplication-square70x70logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-70x70.png"><meta name="msapplication-square150x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-150x150.png"><meta name="msapplication-wide310x150logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x150.png"><meta name="msapplication-square310x310logo" content="https://resources.jetbrains.com/storage/ui/favicons/mstile-310x310.png"><meta name="image" content=""><!-- Open Graph --><meta property="og:title" content="Module 1 / Chapitre 5 : Protection contre les Attaques CSRF | Spring Security"><meta property="og:description" content=""><meta property="og:image" content=""><meta property="og:site_name" content="Spring Security Help"><meta property="og:type" content="website"><meta property="og:locale" content="en_US"><meta property="og:url" content="writerside-documentation/005-00-csrf.html"><!-- End Open Graph --><!-- Twitter Card --><meta name="twitter:card" content="summary_large_image"><meta name="twitter:site" content=""><meta name="twitter:title" content="Module 1 / Chapitre 5 : Protection contre les Attaques CSRF | Spring Security"><meta name="twitter:description" content=""><meta name="twitter:creator" content=""><meta name="twitter:image:src" content=""><!-- End Twitter Card --><!-- Schema.org WebPage --><script type="application/ld+json">{
    "@context": "http://schema.org",
    "@type": "WebPage",
    "@id": "writerside-documentation/005-00-csrf.html#webpage",
    "url": "writerside-documentation/005-00-csrf.html",
    "name": "Module 1 / Chapitre 5 : Protection contre les Attaques CSRF | Spring Security",
    "description": "",
    "image": "",
    "inLanguage":"en-US"
}</script><!-- End Schema.org --><!-- Schema.org WebSite --><script type="application/ld+json">{
    "@type": "WebSite",
    "@id": "writerside-documentation/#website",
    "url": "writerside-documentation/",
    "name": "Spring Security Help"
}</script><!-- End Schema.org --></head><body data-id="005-00-csrf" data-main-title="Module 1 / Chapitre 5 : Protection contre les Attaques CSRF" data-article-props="{&quot;seeAlsoStyle&quot;:&quot;links&quot;}" data-template="article" data-breadcrumbs=""><div class="wrapper"><main class="panel _main"><header class="panel__header"><div class="container"><h3>Spring Security  Help</h3><div class="panel-trigger"></div></div></header><section class="panel__content"><div class="container"><article class="article" data-shortcut-switcher="inactive"><h1 data-toc="005-00-csrf" id="005-00-csrf.md">Module 1 / Chapitre 5 : Protection contre les Attaques CSRF</h1><section class="chapter"><h2 id="l-essentiel" data-toc="l-essentiel">L'essentiel</h2><section class="chapter"><h3 id="objectifs-p-dagogiques" data-toc="objectifs-p-dagogiques">Objectifs p&eacute;dagogiques</h3><p id="-ilefto_10">&Agrave; la fin de ce chapitre, vous serez capable de :</p><ul class="list _bullet" id="-ilefto_11"><li class="list__item" id="-ilefto_12"><p id="-ilefto_16"><span class="control" id="-ilefto_17">Expliquer</span> ce qu'est une attaque CSRF et comment elle fonctionne.</p></li><li class="list__item" id="-ilefto_13"><p id="-ilefto_18"><span class="control" id="-ilefto_19">Comprendre</span> le m&eacute;canisme de protection par token synchronizer de Spring Security.</p></li><li class="list__item" id="-ilefto_14"><p id="-ilefto_20"><span class="control" id="-ilefto_21">Identifier</span> le token CSRF dans un formulaire HTML et une requ&ecirc;te HTTP.</p></li><li class="list__item" id="-ilefto_15"><p id="-ilefto_22"><span class="control" id="-ilefto_23">Savoir</span> quand et comment d&eacute;sactiver la protection CSRF de mani&egrave;re s&eacute;curis&eacute;e (notamment pour les API REST).</p></li></ul></section><section class="chapter"><h3 id="introduction-le-faux-ordre-de-virement" data-toc="introduction-le-faux-ordre-de-virement">Introduction : Le Faux Ordre de Virement</h3><p id="-ilefto_24">Imaginez le sc&eacute;nario suivant. Vous &ecirc;tes tranquillement connect&eacute; sur le site de votre banque en ligne pour consulter votre solde. Dans un autre onglet, vous naviguez sur un forum de discussion et vous cliquez sur une image de chaton mignon. Mais derri&egrave;re cette image se cache un pi&egrave;ge.</p><p id="-ilefto_25">Sans que vous le sachiez, votre navigateur a &eacute;t&eacute; forc&eacute; d'envoyer une requ&ecirc;te vers le site de votre banque. Cette requ&ecirc;te ressemble &agrave; <code class="code" id="-ilefto_28">https://mabanque.com/virement?montant=1000&amp;destinataire=PIRATE</code>. Comme vous &eacute;tiez d&eacute;j&agrave; authentifi&eacute; sur le site de la banque, votre navigateur a gentiment joint votre cookie de session &agrave; la requ&ecirc;te. Pour la banque, cette requ&ecirc;te est l&eacute;gitime : elle vient de votre navigateur, avec votre cookie de session valide. Un virement de 1000&euro; vient d'&ecirc;tre effectu&eacute; &agrave; votre insu.</p><p id="-ilefto_26">Cette attaque s'appelle <span class="control" id="-ilefto_29">CSRF (Cross-Site Request Forgery)</span>, ou &quot;Falsification de requ&ecirc;te inter-site&quot;. Elle force le navigateur d'un utilisateur authentifi&eacute; &agrave; ex&eacute;cuter une action non d&eacute;sir&eacute;e sur un autre site.</p><p id="-ilefto_27">Heureusement, Spring Security int&egrave;gre une protection tr&egrave;s efficace contre ce type d'attaque, et elle est activ&eacute;e par d&eacute;faut. Ce chapitre va vous montrer comment ce bouclier fonctionne.</p></section><section class="chapter"><h3 id="comment-spring-security-prot-ge-contre-le-csrf" data-toc="comment-spring-security-prot-ge-contre-le-csrf">Comment Spring Security prot&egrave;ge contre le CSRF ?</h3><p id="-ilefto_30">La technique utilis&eacute;e par Spring Security est le <span class="control" id="-ilefto_35">Synchronizer Token Pattern</span>. Le principe est simple mais redoutable :</p><ol class="list _decimal" id="-ilefto_31" type="1"><li class="list__item" id="-ilefto_36"><p id="-ilefto_40">Quand un utilisateur se connecte, le serveur g&eacute;n&egrave;re un <span class="control" id="-ilefto_41">token CSRF</span> secret, unique et impr&eacute;visible. Il le stocke c&ocirc;t&eacute; serveur, dans la session de l'utilisateur.</p></li><li class="list__item" id="-ilefto_37"><p id="-ilefto_42">Pour chaque page HTML contenant un formulaire qui modifie l'&eacute;tat de l'application (POST, PUT, DELETE), le serveur ins&egrave;re ce m&ecirc;me token CSRF dans un champ cach&eacute; du formulaire.</p></li><li class="list__item" id="-ilefto_38"><p id="-ilefto_43">Lorsque l'utilisateur soumet le formulaire, le navigateur envoie les donn&eacute;es du formulaire <span class="control" id="-ilefto_44">ET</span> le token CSRF cach&eacute;.</p></li><li class="list__item" id="-ilefto_39"><p id="-ilefto_45">&Agrave; la r&eacute;ception, le serveur effectue une double v&eacute;rification :</p><ul class="list _bullet" id="-ilefto_46"><li class="list__item" id="-ilefto_47"><p id="-ilefto_49">L'utilisateur est-il bien authentifi&eacute; (via le cookie de session) ?</p></li><li class="list__item" id="-ilefto_48"><p id="-ilefto_50">Le token CSRF re&ccedil;u dans le formulaire correspond-il &agrave; celui stock&eacute; dans la session de l'utilisateur ?</p></li></ul></li></ol><p id="-ilefto_32"><span class="control" id="-ilefto_51">Pourquoi est-ce efficace ?</span></p><p id="-ilefto_33">Un attaquant sur un site externe (<code class="code" id="-ilefto_52">forum-chatons.com</code>) ne peut pas conna&icirc;tre le token CSRF secret qui se trouve dans la page de votre banque. Il peut forcer votre navigateur &agrave; envoyer la requ&ecirc;te, mais il ne peut pas y inclure le bon token. Le serveur, ne voyant pas de token ou un token invalide, rejettera la requ&ecirc;te. L'attaque &eacute;choue.</p><style>.theme-dark .plantuml > svg {filter: hue-rotate(180deg) invert(0.9);}div.plantuml {overflow-x: auto;}</style><div class="plantuml"><?xml version="1.0" encoding="us-ascii" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="676px" preserveAspectRatio="none" style="width:993px;height:676px;background:#FFFFFF;" version="1.1" viewBox="0 0 993 676" width="993px" zoomAndPan="magnify"><defs/><g><line style="stroke:#696969;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="23" x2="23" y1="81.4883" y2="595.1465"/><line style="stroke:#696969;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="86" x2="86" y1="81.4883" y2="595.1465"/><line style="stroke:#696969;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="492" x2="492" y1="81.4883" y2="595.1465"/><line style="stroke:#696969;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="923.5" x2="923.5" y1="81.4883" y2="595.1465"/><text fill="#454645" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="5" y="78.5352">User</text><ellipse cx="23.5" cy="13.5" fill="#454645" rx="8" ry="8" style="stroke:#454645;stroke-width:0.5;"/><path d="M23.5,21.5 L23.5,48.5 M10.5,29.5 L36.5,29.5 M23.5,48.5 L10.5,63.5 M23.5,48.5 L36.5,63.5 " fill="none" style="stroke:#454645;stroke-width:0.5;"/><text fill="#454645" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="31" x="5" y="607.6816">User</text><ellipse cx="23.5" cy="619.1348" fill="#454645" rx="8" ry="8" style="stroke:#454645;stroke-width:0.5;"/><path d="M23.5,627.1348 L23.5,654.1348 M10.5,635.1348 L36.5,635.1348 M23.5,654.1348 L10.5,669.1348 M23.5,654.1348 L36.5,669.1348 " fill="none" style="stroke:#454645;stroke-width:0.5;"/><rect fill="#FF6347" height="30.4883" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="69" x="52" y="50"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="59" y="70.5352">Browser</text><rect fill="#FF6347" height="30.4883" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="69" x="52" y="594.1465"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="59" y="614.6816">Browser</text><rect fill="#FF6347" height="46.9766" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="101" x="442" y="33.5117"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87" x="449" y="54.0469">Site L&#233;gitime</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86" x="449.5" y="70.5352">(ex: Banque)</text><rect fill="#FF6347" height="46.9766" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="101" x="442" y="594.1465"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="87" x="449" y="614.6816">Site L&#233;gitime</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="86" x="449.5" y="631.1699">(ex: Banque)</text><rect fill="#FF6347" height="46.9766" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="116" x="865.5" y="33.5117"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="102" x="872.5" y="54.0469">Site Malveillant</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80" x="883.5" y="70.5352">(ex: Forum)</text><rect fill="#FF6347" height="46.9766" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.5;" width="116" x="865.5" y="594.1465"/><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="102" x="872.5" y="614.6816">Site Malveillant</text><text fill="#FFFFFF" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="80" x="883.5" y="631.1699">(ex: Forum)</text><rect fill="#EEEEEE" height="3" rx="3.5" ry="3.5" style="stroke:#EEEEEE;stroke-width:1.0;" width="986.5" x="0" y="112.1436"/><line style="stroke:#454645;stroke-width:0.5;" x1="0" x2="986.5" y1="112.1436" y2="112.1436"/><line style="stroke:#454645;stroke-width:0.5;" x1="0" x2="986.5" y1="115.1436" y2="115.1436"/><rect fill="#EEEEEE" height="23.3105" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.0;" width="222" x="382.25" y="101.4883"/><text fill="#454645" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="204" x="388.25" y="118.0566">Sc&#233;nario SANS protection CSRF</text><polygon fill="#454645" points="480.5,152.1094,490.5,156.1094,480.5,160.1094,484.5,156.1094" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="23.5" x2="486.5" y1="156.1094" y2="156.1094"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="208" x="30.5" y="151.3672">1. Se connecte (cr&#233;e une session)</text><polygon fill="#454645" points="97.5,181.4199,87.5,185.4199,97.5,189.4199,93.5,185.4199" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="91.5" x2="491.5" y1="185.4199" y2="185.4199"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="259" x="103.5" y="180.6777">2. Envoie la page et un cookie de session</text><polygon fill="#454645" points="911.5,210.7305,921.5,214.7305,911.5,218.7305,915.5,214.7305" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="23.5" x2="917.5" y1="214.7305" y2="214.7305"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166" x="30.5" y="209.9883">3. Visite le site malveillant</text><polygon fill="#454645" points="97.5,240.041,87.5,244.041,97.5,248.041,93.5,244.041" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="91.5" x2="922.5" y1="244.041" y2="244.041"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="341" x="103.5" y="239.2988">4. Envoie une page avec une requ&#234;te cach&#233;e vers l'App</text><polygon fill="#454645" points="480.5,269.3516,490.5,273.3516,480.5,277.3516,484.5,273.3516" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="86.5" x2="486.5" y1="273.3516" y2="273.3516"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="269" x="93.5" y="268.6094">5. Envoie la requ&#234;te + le cookie de session</text><line style="stroke:#454645;stroke-width:1.0;" x1="492.5" x2="534.5" y1="302.6621" y2="302.6621"/><line style="stroke:#454645;stroke-width:1.0;" x1="534.5" x2="534.5" y1="302.6621" y2="315.6621"/><line style="stroke:#454645;stroke-width:1.0;" x1="493.5" x2="534.5" y1="315.6621" y2="315.6621"/><polygon fill="#454645" points="503.5,311.6621,493.5,315.6621,503.5,319.6621,499.5,315.6621" style="stroke:#454645;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="274" x="499.5" y="297.9199">6. V&#233;rifie le cookie (OK) et ex&#233;cute l'action !</text><rect fill="#EEEEEE" height="3" rx="3.5" ry="3.5" style="stroke:#EEEEEE;stroke-width:1.0;" width="986.5" x="0" y="344.3174"/><line style="stroke:#454645;stroke-width:0.5;" x1="0" x2="986.5" y1="344.3174" y2="344.3174"/><line style="stroke:#454645;stroke-width:0.5;" x1="0" x2="986.5" y1="347.3174" y2="347.3174"/><rect fill="#EEEEEE" height="23.3105" rx="3.5" ry="3.5" style="stroke:#454645;stroke-width:1.0;" width="224" x="381.25" y="333.6621"/><text fill="#454645" font-family="sans-serif" font-size="13" font-weight="bold" lengthAdjust="spacing" textLength="206" x="387.25" y="350.2305">Sc&#233;nario AVEC protection CSRF</text><polygon fill="#454645" points="480.5,384.2832,490.5,388.2832,480.5,392.2832,484.5,388.2832" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="23.5" x2="486.5" y1="388.2832" y2="388.2832"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="317" x="30.5" y="383.541">1. Se connecte (cr&#233;e une session + un token CSRF)</text><polygon fill="#454645" points="97.5,413.5938,87.5,417.5938,97.5,421.5938,93.5,417.5938" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="91.5" x2="491.5" y1="417.5938" y2="417.5938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="360" x="103.5" y="412.8516">2. Envoie la page avec le token CSRF dans les formulaires</text><polygon fill="#454645" points="911.5,442.9043,921.5,446.9043,911.5,450.9043,915.5,446.9043" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="23.5" x2="917.5" y1="446.9043" y2="446.9043"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="166" x="30.5" y="442.1621">3. Visite le site malveillant</text><polygon fill="#454645" points="97.5,472.2148,87.5,476.2148,97.5,480.2148,93.5,476.2148" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="91.5" x2="922.5" y1="476.2148" y2="476.2148"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="341" x="103.5" y="471.4727">4. Envoie une page avec une requ&#234;te cach&#233;e vers l'App</text><polygon fill="#454645" points="480.5,501.5254,490.5,505.5254,480.5,509.5254,484.5,505.5254" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="86.5" x2="486.5" y1="505.5254" y2="505.5254"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="382" x="93.5" y="500.7832">5. Envoie la requ&#234;te + cookie de session (SANS le bon token)</text><line style="stroke:#454645;stroke-width:1.0;" x1="492.5" x2="534.5" y1="534.8359" y2="534.8359"/><line style="stroke:#454645;stroke-width:1.0;" x1="534.5" x2="534.5" y1="534.8359" y2="547.8359"/><line style="stroke:#454645;stroke-width:1.0;" x1="493.5" x2="534.5" y1="547.8359" y2="547.8359"/><polygon fill="#454645" points="503.5,543.8359,493.5,547.8359,503.5,551.8359,499.5,547.8359" style="stroke:#454645;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="417" x="499.5" y="530.0938">6. V&#233;rifie le cookie (OK) mais le token CSRF est manquant/invalide</text><polygon fill="#454645" points="97.5,573.1465,87.5,577.1465,97.5,581.1465,93.5,577.1465" style="stroke:#454645;stroke-width:1.0;"/><line style="stroke:#454645;stroke-width:1.0;" x1="91.5" x2="491.5" y1="577.1465" y2="577.1465"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="202" x="103.5" y="572.4043">7. Rejette la requ&#234;te (Erreur 403)</text><!--SRC=[rLFDJjj04BxxAGOksAgQjlnLYfHA0OLBAPMmuDJBi1bW6dlNpAvTNicyXb-CMUCca710uiJ9ykZxPhuVUolSKadGy9MW3Kc29ZY12q-IL2Y13LSwXoDn_zPdspa7WjEklU709VsnATsFuGZjNKtPDg27QLMzmlY5HKDS53ePE2TEwdAWX81cePUIoGHoqxKMXHtaqxCSAd61J61duJW_Fu7998b2uVEFU6aCtqQG4nXdhQ88KYDTIr1R0a_UAorB51VXWvqnx8vWPXl710L2XJS459IXIzn2X_CbTNLf43Y6lH5Sie-E2eN5Pxboblp7lJYtlpmNLVNti27JlmdTrTs3RZ5eRgFmXiH3iHD371OidHuybxqaVef2DfKFddlYeMhkMk5hfcVWzFVFB1gd-wurTJIqWqyvRwtrCBsS7R-_1rMg6GUteASDR-cbpqabhrWmHwi1aOTh9sLT80lvZz7JHacGzb-u2hnoGpBPMuihaVrQCkI3ZlL7L8TVs3POy9msGlu-WdFwIo6yb9VEHAWMsF-wboMF]--></g></svg></div></section><section class="chapter"><h3 id="le-token-csrf-en-pratique" data-toc="le-token-csrf-en-pratique">Le token CSRF en pratique</h3><p id="-ilefto_53">Vous l'avez d&eacute;j&agrave; utilis&eacute; sans forc&eacute;ment y pr&ecirc;ter attention ! Dans les chapitres pr&eacute;c&eacute;dents, lorsque nous avons cr&eacute;&eacute; notre formulaire de connexion personnalis&eacute;, nous avons inclus cette ligne cruciale :</p><div class="code-block" data-lang="markup">
&lt;input type=&quot;hidden&quot;
       th:name=&quot;${_csrf.parameterName}&quot;
       th:value=&quot;${_csrf.token}&quot;/&gt;
</div><ul class="list _bullet" id="-ilefto_55"><li class="list__item" id="-ilefto_59"><p id="-ilefto_62"><code class="code" id="-ilefto_63">_csrf</code> est un objet que Spring Security met &agrave; disposition dans le mod&egrave;le de la vue.</p></li><li class="list__item" id="-ilefto_60"><p id="-ilefto_64"><code class="code" id="-ilefto_65">_csrf.parameterName</code> est le nom du param&egrave;tre que le serveur s'attend &agrave; recevoir (par d&eacute;faut, <code class="code" id="-ilefto_66">_csrf</code>).</p></li><li class="list__item" id="-ilefto_61"><p id="-ilefto_67"><code class="code" id="-ilefto_68">_csrf.token</code> est la valeur du fameux token.</p></li></ul><p id="-ilefto_56">Si vous inspectez le code source de votre page de connexion dans le navigateur, vous verrez le HTML g&eacute;n&eacute;r&eacute; :</p><div class="code-block" data-lang="markup">
&lt;input type=&quot;hidden&quot; name=&quot;_csrf&quot; value=&quot;a1b2c3d4-e5f6-...&quot;&gt;
</div><p id="-ilefto_58">C'est ce champ qui assure la s&eacute;curit&eacute; de toutes vos actions de type POST, PUT et DELETE.</p></section><section class="chapter"><h3 id="d-sactivation-de-la-protection-csrf-et-pourquoi-c-est-parfois-n-cessaire" data-toc="d-sactivation-de-la-protection-csrf-et-pourquoi-c-est-parfois-n-cessaire">D&eacute;sactivation de la protection CSRF (et pourquoi c'est parfois n&eacute;cessaire)</h3><p id="-ilefto_69">La protection CSRF est con&ccedil;ue pour les applications web traditionnelles o&ugrave; les requ&ecirc;tes sont initi&eacute;es par des formulaires dans un navigateur.</p><p id="-ilefto_70">Cependant, dans d'autres contextes, elle peut &ecirc;tre inutile, voire probl&eacute;matique :</p><ul class="list _bullet" id="-ilefto_71"><li class="list__item" id="-ilefto_76"><p id="-ilefto_77"><span class="control" id="-ilefto_78">API REST stateless</span>: Si votre backend ne sert qu'une API REST consomm&eacute;e par un client &quot;non-navigateur&quot; (une application mobile, un autre service) ou un frontend JavaScript moderne (comme React, Angular, Vue) utilisant des tokens d'authentification (comme JWT) dans les en-t&ecirc;tes, la protection CSRF bas&eacute;e sur la session n'est plus pertinente. Les clients non-navigateurs ne stockent pas de cookies de session de la m&ecirc;me mani&egrave;re et ne sont donc pas vuln&eacute;rables &agrave; ce type d'attaque.</p></li></ul><p id="-ilefto_72">Pour d&eacute;sactiver la protection CSRF, on le fait dans la <code class="code" id="-ilefto_79">SecurityFilterChain</code>.</p><div class="code-block" data-lang="java">
// Dans SecurityConfig.java, méthode securityFilterChain

http
        // ...
        .csrf(csrf -&gt;csrf.disable()); // Désactive la protection CSRF
// ...
</div><aside class="prompt" data-type="warning" data-title="Désactiver avec discernement !" id="-ilefto_74"><p>Ne d&eacute;sactivez JAMAIS la protection CSRF globalement si votre application sert &agrave; la fois des pages web avec des formulaires et une API REST. Dans ce cas, vous devez la d&eacute;sactiver s&eacute;lectivement uniquement pour les endpoints de votre API. Nous verrons comment faire cela dans la section &quot;Pour aller plus loin&quot;.</p></aside></section></section><section class="chapter"><h2 id="pour-aller-plus-loin" data-toc="pour-aller-plus-loin">Pour aller plus loin</h2><section class="chapter"><h3 id="d-sactivation-s-lective-de-la-protection-csrf" data-toc="d-sactivation-s-lective-de-la-protection-csrf">D&eacute;sactivation s&eacute;lective de la protection CSRF</h3><p id="-ilefto_86">Imaginons que notre application TaskMaster expose une API REST sous <code class="code" id="-ilefto_90">/api/**</code> mais sert aussi une interface d'administration web avec des formulaires sous <code class="code" id="-ilefto_91">/admin/**</code>.</p><p id="-ilefto_87">Nous voulons d&eacute;sactiver CSRF pour l'API, mais la garder active pour l'interface d'administration.</p><div class="code-block" data-lang="java">
// Dans SecurityConfig.java, méthode securityFilterChain

http
        .csrf(csrf -&gt;csrf
        // Ignore la protection CSRF pour toutes les requêtes commençant par /api/
        .ignoringRequestMatchers(&quot;/api/**&quot;)
    )
// ... le reste de la configuration
</div><p id="-ilefto_89">De cette fa&ccedil;on, les clients de l'API REST n'auront pas besoin de g&eacute;rer le token CSRF, tandis que les formulaires de la partie admin resteront prot&eacute;g&eacute;s.</p></section><section class="chapter"><h3 id="protection-csrf-pour-les-applications-javascript-ex-spa" data-toc="protection-csrf-pour-les-applications-javascript-ex-spa">Protection CSRF pour les applications JavaScript (ex: SPA)</h3><p id="-ilefto_92">Si vous d&eacute;veloppez une Single Page Application (SPA) avec Angular ou React, qui est servie par le m&ecirc;me domaine que votre backend Spring Boot et qui utilise une authentification par session (cookies), vous DEVEZ utiliser la protection CSRF.</p><p id="-ilefto_93">Mais comment le frontend peut-il obtenir le token ? Spring Security propose une solution &eacute;l&eacute;gante : le * <span class="emphasis" id="-ilefto_99">Cookie-to-Header Token</span>*.</p><ol class="list _decimal" id="-ilefto_94" type="1"><li class="list__item" id="-ilefto_100"><p id="-ilefto_101"><span class="control" id="-ilefto_102">Configuration c&ocirc;t&eacute; Spring Security</span>:</p></li></ol><div class="code-block" data-lang="java">
   // Dans SecurityConfig.java
   import org.springframework.security.web.csrf.CookieCsrfTokenRepository;

   // ...
   http.csrf(
    csrf -&gt; csrf.csrfTokenRepository(
        CookieCsrfTokenRepository.withHttpOnlyFalse()
   )
);

</div><p id="-ilefto_96">Avec cette configuration, au lieu de mettre le token dans le mod&egrave;le de la vue, Spring Security va l'envoyer dans un cookie lisible par JavaScript (par d&eacute;faut, nomm&eacute; <code class="code" id="-ilefto_103">XSRF-TOKEN</code>).</p><ol class="list _decimal" id="-ilefto_97" type="1" start="2"><li class="list__item" id="-ilefto_104"><p id="-ilefto_105"><span class="control" id="-ilefto_106">C&ocirc;t&eacute; JavaScript (ex: avec Axios)</span>: Votre code JavaScript doit lire la valeur de ce cookie et l'ajouter en tant qu'en-t&ecirc;te HTTP (par d&eacute;faut, <code class="code" id="-ilefto_107">X-XSRF-TOKEN</code>) &agrave; chaque requ&ecirc;te de modification (POST, PUT, DELETE). La plupart des biblioth&egrave;ques HTTP modernes, comme Axios, le font automatiquement si elles d&eacute;tectent la pr&eacute;sence du cookie <code class="code" id="-ilefto_108">XSRF-TOKEN</code>.</p></li></ol><p id="-ilefto_98">Ce m&eacute;canisme est tr&egrave;s s&ucirc;r, car un script sur un domaine malveillant ne peut pas lire le cookie <code class="code" id="-ilefto_109">XSRF-TOKEN</code> de votre domaine d'application (en raison de la Same-Origin Policy des navigateurs).</p></section><section class="chapter"><h3 id="exercice-6-gestion-du-csrf-pour-l-api-de-taskmaster" data-toc="exercice-6-gestion-du-csrf-pour-l-api-de-taskmaster">Exercice 6 : Gestion du CSRF pour l'API de TaskMaster</h3><section class="procedure-steps"><h3 id="exercice-1-6" data-toc="exercice-1-6">Configuration CSRF pour une API et une interface web</h3><p id="-ilefto_111">Dans notre projet <b id="-ilefto_113">TaskMaster</b>, nous allons faire &eacute;voluer notre configuration de s&eacute;curit&eacute; pour qu'elle puisse g&eacute;rer &agrave; la fois notre API REST (sous <code class="code" id="-ilefto_114">/api/**</code>) et une future interface web d'administration (imaginons qu'elle soit sous <code class="code" id="-ilefto_115">/admin/**</code>).</p><ol class="list _decimal" id="-ilefto_112" type="1"><li class="list__item" id="-ilefto_116"><p>Modifiez votre <code class="code" id="-ilefto_119">SecurityConfig</code> pour d&eacute;sactiver la protection CSRF <b id="-ilefto_120">uniquement</b> pour les endpoints commen&ccedil;ant par <code class="code" id="-ilefto_121">/api/**</code>.</p></li><li class="list__item" id="-ilefto_117"><p>V&eacute;rifiez que la protection CSRF reste active pour les autres endpoints. Pour ce faire, nous allons simuler un formulaire de d&eacute;connexion. Spring Security fournit un endpoint de d&eacute;connexion par d&eacute;faut &agrave; <code class="code" id="-ilefto_122">/logout</code> qui doit &ecirc;tre appel&eacute; via une requ&ecirc;te POST pour des raisons de s&eacute;curit&eacute; (afin d'&eacute;viter qu'un lien malveillant ne d&eacute;connecte l'utilisateur). </p><ul class="list _bullet" id="-ilefto_123"><li class="list__item" id="-ilefto_124"><p>Ajoutez la configuration de la d&eacute;connexion &agrave; votre <code class="code" id="-ilefto_127">securityFilterChain</code>: </p><div class="code-block" data-lang="java">
                // À ajouter à la fin de la chaîne de configuration http
                .logout(logout -&gt; logout.logoutSuccessUrl(&quot;/connexion?logout&quot;));
                </div></li><li class="list__item" id="-ilefto_125"><p>Cr&eacute;ez une page <code class="code" id="-ilefto_129">projects.html</code> dans <code class="code" id="-ilefto_130">templates</code> qui sera affich&eacute;e apr&egrave;s la connexion. Cette page doit contenir un bouton de d&eacute;connexion.</p></li><li class="list__item" id="-ilefto_126"><p>Modifiez la redirection apr&egrave;s connexion pour pointer vers <code class="code" id="-ilefto_131">/projects</code> au lieu de <code class="code" id="-ilefto_132">/api/projects</code>. Cr&eacute;ez un contr&ocirc;leur pour afficher cette page.</p></li></ul></li><li class="list__item" id="-ilefto_118"><p>Testez le formulaire de d&eacute;connexion <b id="-ilefto_133">avec</b> et <b id="-ilefto_134">sans</b> le champ cach&eacute; du token CSRF pour observer la diff&eacute;rence de comportement.</p></li></ol><ol class="list _decimal"></ol></section></section><section class="chapter"><div class="collapse"><div class="collapse__title"><h3 id="correction-exercice-6" data-toc="correction-exercice-6">Correction exercice 6</h3></div><div class="collapse__content"><p id="-ilefto_135"><span class="control" id="-ilefto_143">1. <code class="code" id="-ilefto_144">SecurityConfig.java</code> mise &agrave; jour</span></p><div class="code-block" data-lang="java">
package fr.formation.spring.taskmaster.config;

// ... imports ...

@Configuration
@EnableWebSecurity
@EnableMethodSecurity
public class SecurityConfig {

    @Bean
    public SecurityFilterChain securityFilterChain(HttpSecurity http)
            throws Exception {
        http
                .authorizeHttpRequests(auth -&gt; auth
                        .requestMatchers(&quot;/api/admin/**&quot;).hasRole(&quot;ADMIN&quot;)
                        // On considère maintenant /api/projects comme une API
                        .requestMatchers(&quot;/api/**&quot;).authenticated()
                        // La nouvelle page de projet est pour les utilisateurs connectés
                        .requestMatchers(&quot;/projects&quot;).authenticated()
                        .requestMatchers(&quot;/connexion&quot;).permitAll()
                        .anyRequest().denyAll()
                )
                .formLogin(form -&gt; form
                        .loginPage(&quot;/connexion&quot;)
                        .loginProcessingUrl(&quot;/connexion&quot;)
                        // Redirige vers la page HTML, pas l'API
                        .defaultSuccessUrl(&quot;/projects&quot;, true)
                        .permitAll()
                )
                .logout(logout -&gt; logout
                        // URL de déconnexion (POST par défaut)
                        .logoutUrl(&quot;/logout&quot;)
                        // URL de redirection après déconnexion
                        .logoutSuccessUrl(&quot;/connexion?logout&quot;)
                )
                .csrf(csrf -&gt; csrf
                        // On désactive CSRF pour l'API REST
                        .ignoringRequestMatchers(&quot;/api/**&quot;)
                );

        return http.build();
    }

    // ... le reste de la classe ...
}
</div><p id="-ilefto_137"><span class="control" id="-ilefto_145">2. Nouveau contr&ocirc;leur pour la page des projets</span></p><div class="code-block" data-lang="java">
package fr.formation.spring.taskmaster.controller;

import org.springframework.stereotype.Controller;
import org.springframework.web.bind.annotation.GetMapping;

@Controller
public class ProjectViewController {

    @GetMapping(&quot;/projects&quot;)
    public String showProjectsPage() {
        return &quot;projects&quot;; // Renvoie templates/projects.html
    }
}
</div><p id="-ilefto_139"><span class="control" id="-ilefto_146">3. Page <code class="code" id="-ilefto_147">templates/projects.html</code></span></p><div class="code-block" data-lang="markup">
&lt;!DOCTYPE html&gt;
&lt;html lang=&quot;fr&quot; xmlns:th=&quot;http://www.thymeleaf.org&quot;&gt;
&lt;head&gt;
    &lt;meta charset=&quot;UTF-8&quot;&gt;
    &lt;title&gt;Mes Projets - TaskMaster&lt;/title&gt;
&lt;/head&gt;
&lt;body&gt;
&lt;h1&gt;Bienvenue sur TaskMaster&lt;/h1&gt;
&lt;p&gt;Ceci est la page des projets.&lt;/p&gt;

&lt;!-- Formulaire de déconnexion SÉCURISÉ --&gt;
&lt;form th:action=&quot;@{/logout}&quot; method=&quot;post&quot;&gt;
    &lt;!-- Sans cette ligne, la déconnexion échouera avec une erreur 403 --&gt;
    &lt;input type=&quot;hidden&quot;
           th:name=&quot;${_csrf.parameterName}&quot;
           th:value=&quot;${_csrf.token}&quot;/&gt;
    &lt;button type=&quot;submit&quot;&gt;Se déconnecter&lt;/button&gt;
&lt;/form&gt;
&lt;/body&gt;
&lt;/html&gt;
</div><p id="-ilefto_141"><span class="control" id="-ilefto_148">R&eacute;sultats des tests :</span></p><ul class="list _bullet" id="-ilefto_142"><li class="list__item" id="-ilefto_149"><p id="-ilefto_152">Avec la ligne <code class="code" id="-ilefto_153">&lt;input type=&quot;hidden&quot; ...&gt;</code>, le bouton &quot;Se d&eacute;connecter&quot; fonctionne parfaitement et vous redirige vers la page de connexion.</p></li><li class="list__item" id="-ilefto_150"><p id="-ilefto_154">Si vous commentez ou supprimez cette ligne et que vous essayez de vous d&eacute;connecter, vous obtiendrez une <span class="control" id="-ilefto_155">erreur 403 Forbidden</span>. La console Spring Security affichera un message d'avertissement indiquant un &quot;Invalid CSRF Token&quot;. Cela prouve que la protection CSRF est bien active pour cet endpoint.</p></li><li class="list__item" id="-ilefto_151"><p id="-ilefto_156">En parall&egrave;le, si vous utilisez un outil comme Postman ou <code class="code" id="-ilefto_157">curl</code> pour faire une requ&ecirc;te POST sur <code class="code" id="-ilefto_158">/api/projects</code> (par exemple), elle fonctionnera sans avoir besoin de fournir de token CSRF.</p></li></ul></div></div></section><section class="chapter"><h3 id="auto-valuation" data-toc="auto-valuation">Auto-&eacute;valuation</h3><ol class="list _decimal" id="-ilefto_159" type="1"><li class="list__item" id="-ilefto_160"><p id="-ilefto_165"><span class="control" id="-ilefto_166">Question ouverte :</span> Expliquez avec une analogie pourquoi une attaque CSRF est dangereuse et comment le &quot; Synchronizer Token Pattern&quot; la contre.</p></li><li class="list__item" id="-ilefto_161"><p id="-ilefto_167"><span class="control" id="-ilefto_169">QCM :</span> Par d&eacute;faut, Spring Security active la protection CSRF pour quelles m&eacute;thodes HTTP ?</p><ul class="list _bullet" id="-ilefto_168"><li class="list__item" id="-ilefto_170"><p id="-ilefto_174">a) GET, HEAD, OPTIONS</p></li><li class="list__item" id="-ilefto_171"><p id="-ilefto_175">b) POST, PUT, DELETE, PATCH</p></li><li class="list__item" id="-ilefto_172"><p id="-ilefto_176">c) Uniquement POST</p></li><li class="list__item" id="-ilefto_173"><p id="-ilefto_177">d) Toutes les m&eacute;thodes HTTP</p></li></ul></li><li class="list__item" id="-ilefto_162"><p id="-ilefto_178"><span class="control" id="-ilefto_180">QCM :</span> Vous d&eacute;veloppez une API REST stateless qui utilise des tokens JWT pour l'authentification. Quelle est la bonne pratique concernant la protection CSRF ?</p><ul class="list _bullet" id="-ilefto_179"><li class="list__item" id="-ilefto_181"><p id="-ilefto_185">a) La laisser activ&eacute;e pour une s&eacute;curit&eacute; maximale.</p></li><li class="list__item" id="-ilefto_182"><p id="-ilefto_186">b) La d&eacute;sactiver car elle n'est pas pertinente dans ce contexte.</p></li><li class="list__item" id="-ilefto_183"><p id="-ilefto_187">c) La configurer en mode <code class="code" id="-ilefto_188">CookieCsrfTokenRepository</code>.</p></li><li class="list__item" id="-ilefto_184"><p id="-ilefto_189">d) La d&eacute;sactiver uniquement pour les requ&ecirc;tes GET.</p></li></ul></li><li class="list__item" id="-ilefto_163"><p id="-ilefto_190"><span class="control" id="-ilefto_191">Question ouverte :</span> Pourquoi le fait d'appeler la d&eacute;connexion via une requ&ecirc;te POST est-il une mesure de s&eacute;curit&eacute; en soi ?</p></li><li class="list__item" id="-ilefto_164"><p id="-ilefto_192"><span class="control" id="-ilefto_194">QCM :</span> Si vous oubliez d'inclure le token CSRF dans un formulaire soumis via POST, quelle erreur HTTP recevrez-vous le plus probablement ?</p><ul class="list _bullet" id="-ilefto_193"><li class="list__item" id="-ilefto_195"><p id="-ilefto_199">a) 404 Not Found</p></li><li class="list__item" id="-ilefto_196"><p id="-ilefto_200">b) 401 Unauthorized</p></li><li class="list__item" id="-ilefto_197"><p id="-ilefto_201">c) 500 Internal Server Error</p></li><li class="list__item" id="-ilefto_198"><p id="-ilefto_202">d) 403 Forbidden</p></li></ul></li></ol></section><section class="chapter"><h3 id="conclusion" data-toc="conclusion">Conclusion</h3><p id="-ilefto_203">Bravo ! Vous avez termin&eacute; le premier module de notre formation sur Spring Security. Vous avez non seulement pos&eacute; des bases solides, mais vous avez aussi explor&eacute; des concepts qui &eacute;chappent &agrave; de nombreux d&eacute;veloppeurs.</p><p id="-ilefto_204">Vous avez appris &agrave; identifier les menaces, &agrave; installer et configurer Spring Security, &agrave; g&eacute;rer l'authentification avec des pages personnalis&eacute;es et un stockage de mot de passe s&eacute;curis&eacute;, &agrave; d&eacute;finir des r&egrave;gles d'autorisation fines, et enfin, &agrave; comprendre et ma&icirc;triser la protection contre les attaques CSRF.</p><p id="-ilefto_205">Vous poss&eacute;dez maintenant toutes les cl&eacute;s pour s&eacute;curiser une application web standard bas&eacute;e sur des sessions.</p><p id="-ilefto_206">Dans le <span class="control" id="-ilefto_207">Module 2</span>, nous irons encore plus loin. Nous abandonnerons les utilisateurs en m&eacute;moire pour une gestion persistante en base de donn&eacute;es, nous apprendrons &agrave; cr&eacute;er nos propres filtres d'authentification, et nous nous attaquerons &agrave; des sujets modernes et essentiels comme les <span class="control" id="-ilefto_208">JSON Web Tokens (JWT)</span> et <span class="control" id="-ilefto_209">l'authentification via des fournisseurs externes comme Google (OAuth 2.0)</span>. La route est passionnante, et vous &ecirc;tes parfaitement &eacute;quip&eacute; pour la suite</p></section></section><div class="last-modified">15 juin 2025</div><div data-feedback-placeholder="true"></div><div class="navigation-links _bottom"><a href="004-00-access-control.html" class="navigation-links__prev">Module 1 / Chapitre 4 : Autorisation &ndash; Contr&ocirc;le d'Acc&egrave;s</a><a href="006-00-user-in-database.html" class="navigation-links__next">Module 2 / Chapitre 6 : Gestion des Utilisateurs en Base de Donn&eacute;es</a></div></article><div id="disqus_thread"></div></div></section></main></div><script src="https://resources.jetbrains.com/writerside/apidoc/6.22.0-b776/app.js"></script></body></html>